PageModuleTimeline.prototype=new Module;PageModuleTimeline.prototype.constructor=PageModuleTimeline;function PageModuleTimeline(a){Module.call(this,a);$.extend(this.setting,{blank:!0})}
PageModuleTimeline.prototype.Init=function(a){Module.prototype.Init.call(this,a);var b=this;this.form.on("click",".view-more",function(a){var c=b.form.find(".posts .post");0<c.length&&b.Load({query:{skip:c.length}});a.preventDefault();a.stopPropagation()});b.onRouter(function(a){try{var c=a.param.tab}catch(e){}if(void 0!=c){var f=b.form.find(".tabmenu:first>li[md-tab="+c+"]");if(f.length=!f.hasClass("active")){var g=b.form.find(".tabmenu:first>li.active");b.form.find(".tabmenu:first>li").removeClass("active");
f.addClass("active");f=g.attr("md-tab");b.form.find(".posts:first .post").remove();b.Load({query:{},url:a.url});b.form.find(".posts:first").removeClass(f).addClass(c)}}},{param:1});b.modal=$('<div class="Timeline modal fade" role="dialog" aria-hidden="true"><div class="dialog col-md-10 col-md-offset-1"><div class="modal-content"></div></div></div>').modal({show:!1});b.form.on("click",".post",function(a){$(a.target).is(".title")||(a=$(this).attr("post-id"),b.Load({query:{action:"info",tab:"info",post:[a]},
callback:function(a){void 0!=a.post&&(a=b.Render("info",a.post),b.modal.find(".modal-content").html(a),b.modal.modal("show"),b.Refesh())}}))});var e="";b.modal.on("shown.bs.modal",function(a){e=""}).on("hidden.bs.modal",function(a){""!=e&&b.app._Router.Goto(e);b.modal.find(".modal-content").html("")}).on("click","[site-goto]",function(a){e=$(this).attr("href");b.modal.modal("hide");a.preventDefault();a.stopPropagation()});b.modal.on("click",".modal-footer .btn.view",function(){b.modal.modal("hide")})};
PageModuleTimeline.prototype.Load=function(a){a=$.extend({query:{},callback:void 0,url:window.location.href},a);if(void 0!=a.query.post){"string"==typeof a.query.time&&$.each(this.form.find(".main .post"),function(b,d){var c=$(d);c.find(".time:first").attr("time")==a.query.time&&a.query.post.push(c.attr("post-id"))});"string"==typeof a.query.view&&$.each(this.form.find(".main .post"),function(b,d){var c=$(d);c.find(".view .value:first").html()==a.query.view&&a.query.post.push(c.attr("post-id"))});
var b=[];$.each(a.query.post,function(a,d){-1===$.inArray(d,b)&&b.push(d)});a.query.post=b.join(",")}Module.prototype.Load.call(this,a)};
PageModuleTimeline.prototype.Refesh=function(){Module.prototype.Refesh.call(this);if(450>this.form.width()){var a=this.form.find(".posts .post");$.each(a,function(a,b){$(b).addClass("mini")})}try{var b=this.modal.find(".facebook-comment"),e=b.attr("href");0==b.children().length&&$('<div class="fb-comments" data-width="100%" data-href="'+e+'" data-numposts="10" data-colorscheme="light"></div>').appendTo(b)}catch(d){}this.setting.more&&(a=this.form.find(".footer .view-more"),a.data("md-mored")||(this.setting.more?
a.show():a.hide(),a.data("md-mored",!0)));"number"==typeof this.setting["max-height"]&&0<this.setting["max-height"]&&(a=this.form.find(".main:first"),a.data("md-heighted")||(a.css("max-height",this.setting["max-height"]+"vh"),a.data("md-heighted",!0)));a=this.form.find(".post .rate");$.each(a,function(a,b){var c=$(b);0==c.find(".rating-input").length&&c.find(".rating").rating({editable:!1})});this.setting.blank&&(this.form.find("[site-goto]").removeAttr("site-goto").attr("target","_blank"),this.modal.find(".modal-footer .btn.view[site-goto]").removeAttr("site-goto").attr("target",
"_blank"));a=this.form.find("img.lazy");$.each(a,function(a,b){var c=$(b);c.data("lazyed")||($(b).lazyload({effect:"fadeIn"}),c.data("lazyed",!0))});try{FB.XFBML.parse(this.modal[0])}catch(c){}};
