var PageModuleBlogPost=function(a){this.app=a;this.setting={"class":{},trigger:{},like:!0,toolbar:"affix"};this.template={};this.store={};this.ajax_loading=!1};
PageModuleBlogPost.prototype={Description:function(){return"this.descript"},Init:function(a){if("undefined"==typeof this.inited)this.inited=!0;else return!0;var b=this;this.form=a;a=JSON.parse(Base64.decode(this.form.attr("module-setting")));for(var c in a)this.setting[c]=a[c];b.template.post=Base64.decode(b.form.attr("module-template"));this.form.bind("view",function(a,e){"undefined"!=typeof e.id&&b.Load({post:e.id});a.preventDefault();a.stopPropagation()});b.form.on("click",".toolbar .view-beforeafter:first .btn",
function(a){if(!b.ajax_loading){a=$(this);var e={post:b.form.find(".posts .post[post-id]:visible:first").attr("post-id")};a.hasClass("view-before")?e.action="before":e.action="after";b.Load(e)}});b.app._Router.AddCallback(this.form.parents("[site-name]:first").attr("site-name"),this.form.parents("[page-name]:first").attr("page-name"),function(a){a=a.match(/[a-z0-9]{24}/g);null!=a&&0<a.length&&b.Load({post:a[0]})})},Load:function(a){var b=this;this.ajax_loading=!0;if(void 0!=a.post){if(void 0==a.action){var c=
b.form.find(".post[post-id="+a.post+"]");if(0==c.length){var f=b.form.find(".posts .post[post-id]");$.each(f,function(a,h){var c=$(h),d=c.attr("post-id");b.store[d]=c.detach()})}else return 0}void 0!=b.store[a.post]?c.is(":visible")||(b.app._ProcessBar.Reset(),b.app._ProcessBar.Run(100),b.form.find(".posts").append(b.store[a.post]),b.Refesh()):(a.module=this.form.attr("module-id"),b.app._ProcessBar.Reset(),b.app._ProcessBar.Run(50),PageAjax({url:window.location.href,type:"post",dataType:"json",data:a}).done(function(a){b.ajax_loading=
!1;b.form.find(".posts").html("");b.app._ProcessBar.Run(100);void 0!=a.post&&(b.form.find(".main .posts:first").append(b.Render("post",a.post)),b.Refesh());if(void 0!=a.graph){var c=b.form.parents(".site:first").data("site-object");void 0!=c&&c.UpdateGraph(a.graph)}}).error(function(a){b.ajax_loading=!1;console.error(a)}))}},Render:function(a,b){var c=this,f=c.template[a];$.each(b,function(a,b){"link"==a&&window.location.href!=b&&c.app._Router.Goto(b);f=f.split("{{ "+a+" }}").join(b)});return f},
Refesh:function(){var a=this,b=a.form.find(".content .video");$.each(b,function(a,c){var d=$(b),g=d.attr("link"),e=d.parents(".content:first").width(),f=315*e/560;try{g=g.split("youtube.com/watch?v=",2)[1].split("/[#|?]/",1)[0],d.after($('<iframe width="'+e+'" height="'+f+'" src="//www.youtube.com/embed/'+g+'" frameborder="0" allowfullscreen></iframe>')),d.remove()}catch(k){console.error(k)}});try{var c=a.form.find(".warning:first");0<c.children(".content:first").html().length?c.show():c.hide()}catch(f){console.error(f)}"undefined"!=
typeof a.setting["class"]&&$.each(a.setting["class"],function(b,c){var d=a.form.find("."+b);$.each(d,function(a,b){var d=$(b);d.data("md-classed")||d.addClass(c).data("md-classed",!0)})});void 0!=a.setting.trigger&&void 0!=a.setting.trigger.more&&$.each(a.setting.trigger.more,function(b,c){a.form.parents(".page:first").find("[module-id="+c+"]:first").trigger("more","more")});void 0!=a.setting.like&&a.setting.like&&(c=a.form.find(".facebook-likeshare"),$.each(c,function(a,b){var d=$(b);if(!d.data("md-liked")){var c=
d.parents(".post:first").find(".title a:first")[0].href;0==d.children().length&&$('<div class="fb-like " data-width="'+d.width()+'px" data-href="'+c+'" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>').appendTo(d);d.data("md-liked",!0)}}));void 0!=a.setting.toolbar&&"affix"==a.setting.toolbar&&(c=a.form.find(".toolbar"),$.each(c,function(a,b){var c=$(b);if(!c.data("md-toolbar-affixed")){var e=$(".site-headers:first header.site-header").outerHeight();
c.affix({offset:{top:function(){return this.top=c.offset().top-e}}});c.bind("affix.bs.affix",function(a){c.css({top:e,width:c.outerWidth()})});c.bind("affix-top.bs.affix affix-bottom.bs.affix",function(a){c.css({width:"",top:""})});c.data("md-toolbar-affixed",!0)}}));try{FB.XFBML.parse(this.form[0])}catch(e){console.debug(e)}FB.Event.subscribe("edge.create",function(a,b){console.debug(a,b)});FB.Event.subscribe("edge.remove",function(a,b){console.debug(a,b)});this.timer=this.form.find(".user .info .time:first");
this.timer.data("timer")||(a.app._Timer.Add(a.timer),a.timer.data("timer",!0))}};
