PageModuleCineMovie.prototype=new Module;PageModuleCineMovie.prototype.constructor=PageModuleCineMovie;function PageModuleCineMovie(a){Module.call(this,a);$.extend(this.setting,{localstore:!0})}
PageModuleCineMovie.prototype.Init=function(a){if(Module.prototype.Init.call(this,a))return!0;var b=this;this.form.bind("next",function(e,d){var a=0,c=b.form.find(".menu .chap");void 0!=d.index?c.length>d.index&&(a=d.index):$.each(c,function(b,e){$(e).hasClass("active")&&(a=b+1)});c=c.get(a);void 0!=c&&c.click();e.preventDefault();e.stopPropagation()});b.onRouter(function(e){void 0!=e.post&&b.Load({query:{action:"movie",post:e.post},callback:function(e){void 0!=e.post&&(e=b.Render("post",e.post),
b.Movie_Close(),b.form.find(".posts:first").html(e),b.Refesh())}})},{post:1});b.form.on("click",".menu .chap",function(e){var a=$(this);b.form.find(".menu .chap.active").removeClass("active");a.addClass("active");var a=$.parseJSON(Base64.decode(a.attr("chap-server"))),f="",c;for(c in a)var g=a[c],f=f+('<option class="srv" server-index="'+c+'">'+(1+parseInt(c))+". "+g.name+"</option>");c=b.form.find(".menu .srvs:first").html(f);void 0!=b.__lastview&&0<=b.__lastview[1]&&c.find(".srv:eq("+b.__lastview[1]+
")").prop("selected",!0);c.trigger("change");e.preventDefault();e.stopPropagation()});var g=function(e){var a="",f;for(f in e)var c=e[f],a=a+('<li class="part" part-index="'+f+'" data='+Base64.encode(JSON.stringify(c))+">"+c.name+"</li>");a="<ul>"+a+"</ul>";e=b.form.find(".menu .parts:first").html(a);c=void 0!=b.__lastview&&0<=b.__lastview[2]?e.find(".part:eq("+b.__lastview[2]+")"):e.find(".part:first");c.click()};this.form.on("change",".menu .srvs",function(a){a=$(this);var d=a.find("option:selected"),
f=d.attr("server-data");if(void 0!=f)f=$.parseJSON(Base64.decode(f)),g(f);else{var f=b.form.find(".menu .chaps .chap.active").attr("chap-index"),c=d.attr("server-index"),f={action:"part","c-i":f,"s-i":c};1!=b.__tracking&&(b.__tracking=!0,f.track=a.parents(".post[post-id]:first").attr("post-id"));b.Load({query:f,callback:function(b){void 0!=b.post&&(g(b.post),d.attr("server-data",Base64.encode(JSON.stringify(b.post))))}})}});this.form.on("click",".menu .part",function(a){a=$(this);b.form.find(".menu .part.active").removeClass("active");
a.addClass("active");if(a.attr("data")){a=JSON.parse(Base64.decode(a.attr("data")));var d={video:""};a.tracks&&(d.tracks=a.tracks);if("array"==$.type(a.video)){d.video=[];for(var f=a.video.length-1;0<=f;f--){var c=a.video[f];if("video/mpeg4"==c.type||"video/mp4"==c.type)c.type="mp4";if("application/x-shockwave-flash"==c.type||"video/x-flv"==c.type)c.type="flv";"mp4"==c.type||"webm"==c.type?d.video.push({file:c.url,label:c.height+"p",type:c.type}):console.debug(c)}}else"string"==$.type(a.video)&&(d.video=
a.video);b._Player(d)}});b.modal=$('<div class="modal fade" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"></div></div></div>').modal({show:!1});b.form.on("click",".btn.report",function(a){a=$('<div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Y\u00eau c\u1ea7u & B\u00e1o s\u1ef1 c\u1ed1</h4></div><div class="modal-body"><div class="alert alert-info" role="alert">Ch\u00fang t\u00f4i bi\u1ebft \u01a1n v\u00e0 tr\u00e2n tr\u1ecdng m\u1ecdi g\u00f3p \u00fd c\u1ee7a b\u1ea1n, lu\u00f4n c\u00f3 nh\u1eefng ph\u1ea7n qu\u00e0 cho nh\u1eefng g\u00f3p \u00fd hay v\u00e0 thi\u1ec7t th\u1ef1c. Ch\u00e2n th\u00e0nh c\u1ea3m \u01a1n b\u1ea1n \u0111\u00e3 \u1ee7ng h\u1ed9 v\u00e0 g\u00f3p ph\u1ea7n x\u00e2y d\u1ef1ng m\u1ed9t c\u1ed9ng \u0111\u1ed3ng t\u1ed1t h\u01a1n !</div><form class="form-horizontal" role="form"><div class="form-group"><label class="col-sm-2 control-label">Report</label><div class="col-sm-10"><select class="form-control report-select"><option value="update_chap">Y\u00eau c\u1ea7u c\u1eadp nh\u1eadt t\u1eadp m\u1edbi</option><option value="film_die">Phim h\u1ecfng / die</option><option value="film_slow">Phim qu\u00e1 ch\u1eadm</option><option value="others">Y\u00eau c\u1ea7u kh\u00e1c</option></select></div></div><div class="form-group"><label class="col-sm-2 control-label">N\u1ed9i Dung</label><div class="col-sm-10 report-form" of="update_chap"><p>+ t\u1eadp phim b\u1ea1n ngh\u1ec9 \u0111\u00e3 c\u00f3</p><p>+ Ngu\u1ed3n b\u1ea1n \u0111\u00e3 th\u1ea5y c\u00f3 t\u1eadp m\u1edbi (n\u1ebfu c\u00f3)</p><textarea class="form-control" rows="5"></textarea></div><div class="col-sm-10 report-form" of="film_die"><div class="alert alert-info" role="alert">Khi c\u00f3 t\u1eadp phim h\u1ecfng, h\u1ec7 th\u1ed1ng s\u1ebb t\u1ef1 \u0111\u1ed9ng c\u1eadp nh\u1eadt v\u00e0 b\u00e1o c\u00e1o cho ch\u00fang t\u00f4i, \u00fd ki\u1ebfn \u0111\u00f3ng g\u00f3p c\u1ee7a b\u1ea1n \u0111\u00e3 \u0111\u01b0\u1ee3c ghi nh\u1eadn v\u00e0 h\u1eadu t\u1ea1 c\u1ea3m \u01a1n b\u1ea1n nhi\u1ec1u nhi\u1ec1u :3</div></div><div class="col-sm-10 report-form" of="film_slow"><div class="alert alert-info" role="alert">B\u1ea1n h\u00e3y th\u1eed \u0111\u1ed5i server \u0111\u1ec3 t\u00ecm ra server c\u00f3 t\u1ed1c \u0111\u1ed9 t\u1ed1t h\u01a1n, ch\u00fang t\u00f4i \u0111ang ph\u00e1t tri\u1ec3n h\u1ec7 th\u1ed1ng gi\u00fap ng\u01b0\u1eddi d\u00f9ng xem phim nhanh h\u01a1n v\u00e0 s\u1ebb s\u1edbm ra m\u1eaft trong th\u1eddi gian t\u1edbi, xin ch\u00e2n th\u00e0nh c\u1ea3m \u01a1n \u0111\u00f3ng g\u00f3p c\u1ee7a b\u1ea1n :)</div></div><div class="col-sm-10 report-form" of="others"><p>+ ch\u00fang t\u00f4i lu\u00f4n ti\u1ebfp nh\u1eadn \u00fd ki\u1ebfn \u0111\u00f3ng g\u00f3p c\u1ee7a b\u1ea1n v\u00e0 c\u00f3 nh\u1eefng ph\u1ea7n qu\u00e0 cho nh\u1eefng \u00fd ki\u1ebfn, y\u00eau c\u1ea7u hay v\u00e0 thi\u1ebft th\u1ef1c</p><p>+ Y\u00eau c\u1ea7u c\u1ee7a b\u1ea1n kh\u00f4ng n\u00ean qu\u00e1 ng\u1eafn (d\u01b0\u1edbi 50 k\u00fd t\u1ef1 ) ho\u1eb7c qu\u00e1 d\u00e0i (tr\u00ean 1000 k\u00fd t\u1ef1)</p><textarea class="form-control" rows="5"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><button type="button" class="btn btn-primary report-send">Send</button></div>');
b.modal.find(".modal-content").html(a).find(".report-select").trigger("change");b.modal.modal("show")});b.modal.on("change",".report-select",function(a){a=$(this).val();b.modal.find(".report-form").hide();b.modal.find(".report-form[of="+a+"]").show()});b.modal.on("click",".report-send",function(a){a=b.modal.find(".report-select").val();var d=b.modal.find(".report-form[of="+a+"]:visible textarea").val();void 0!=d&&""!=d&&b.Load({query:{action:"report",report:a,content:d.trim()},processbar:!1,callback:function(){}});
b.modal.modal("hide")})};
PageModuleCineMovie.prototype._Player=function(a){var b=this;void 0==b.player_id&&(b.player_id=b.form.find(".player:first").attr("id"),b.player_page=b.form.parents(".page:first").attr("page-name"),jwplayer.key="zrNXd1Q486lXAgoOA0R9aX4+0yGeqik9e4rvFOvhrLB+gsn5aqgzB5L3w/Q=");try{this.player.remove()}catch(g){}setup={width:"100%",aspectratio:"16:9",autostart:"true",volume:"100%",skin:"/static/jwplayer/skins/glow.xml",bufferlength:30,startparam:"start",events:{onReady:function(){try{void 0!=b.__lastview&&
0<=b.__lastview[3]&&(b.player.seek(b.__lastview[3]-10),delete b.__lastview)}catch(a){}b.player.play()},onComplete:function(){b._Player_Next()},onSetupError:function(a){b._Player_Error(a)},onError:function(a){b._Player_Error(a)}}};a.tracks&&(setup.tracks=a.tracks,setup.captions={color:"#FFFFFF",fontSize:22,fontOpacity:100,backgroundOpacity:1,edgeStyle:"uniform"});"array"==$.type(a.video)?setup.sources=a.video:"string"==$.type(a.video)&&(setup.file=a.video);b.player=jwplayer(b.player_id).setup(setup);
b.form.find(".movie .viewer").show();b.form.find(".movie .info").hide()};PageModuleCineMovie.prototype._Player_Next=function(){var a=this.form.find(".post .menu .parts .part.active");0<a.length&&(a=a.next(".part:first"),0<a.length?a.click():(a=this.form.find(".post .menu .chaps .chap.active"),0<a.length?(a=a.next(".chap:first"),0<a.length?a.click():console.debug("finish movie!")):console.debug("chap not fount!")))};PageModuleCineMovie.prototype._Player_Error=function(a){console.error("[-] "+a);console.debug("reporting...!")};
PageModuleCineMovie.prototype.Refesh=function(){Module.prototype.Refesh.call(this);var a=this,b=a.form.find(".posts .post:first"),g=b.find(".screen:first");g.data("md-resized")||(g.height(9*g.width()/16),g.data("md-resized",!0));if(0<b.length&&!b.data("md-movie-listed")){g=b.attr("data-movie");if(0<g.length){var g=JSON.parse(Base64.decode(g)),e="",d;for(d in g)var f=g[d],e=e+('<li class="chap" chap-index="'+d+'" chap-server="'+Base64.encode(JSON.stringify(f.server))+'">'+f.name+"</li>");b.find(".menu .chaps").append(e)}if(a.app._Login.LoggedIn()){if((g=
b.attr("data-lastview"))&&""!=g)for(d in a.__lastview=g.split("|"),a.__lastview)a.__lastview[d]=parseInt(a.__lastview[d])}else d=b.attr("post-id"),(g=a.app._Store.get("mvlastview"))&&g[d]&&(d=$.extend({"mv-chap":"-1","mv-server":"-1","mv-part":"-1","mv-seek":"-1"},g[d]),a.__lastview=[d["mv-chap"],d["mv-server"],d["mv-part"],d["mv-seek"]]);a.__lastview&&0<a.__lastview.length&&-1!=a.__lastview[0]&&b.find(".menu .chaps .chap:eq("+a.__lastview[0]+")").click();b.data("md-movie-listed",!0)}var c=a.form.find(".menu .movie-rate");
0==c.find(".rating-input").length&&c.find(".rating").rating({note:["D\u1edf t\u1ec7","Kh\u00f4ng hay","B\u00ecnh th\u01b0\u1eddng","Hay","R\u1ea5t hay"],onChange:function(b){1!=c.data("rated")&&(a.Load({processbar:!1,query:{action:"rating",rate:b}}),c.data("rated",!0))}});try{FB.XFBML.parse(this.form[0])}catch(h){console.debug(h)}};
PageModuleCineMovie.prototype.Movie_Close=function(){var a=this.form.find(".post[post-id]:first"),b=a.attr("post-id"),g=-1,e=-1,d=-1,f=0,c=a.find(".menu .chaps .chap.active");0<c.length&&(g=c.attr("chap-index"));var h=a.find(".menu .srvs .srv:selected");0<c.length&&(e=h.attr("server-index"));a=a.find(".menu .parts .part.active");0<c.length&&(d=a.attr("part-index"));void 0!=this.player&&(f=this.player.getPosition());0<=g&&(self.app._Login.LoggedIn()?this.Load({query:{action:"viewing",post:b,"mv-chap":g,
"mv-server":e,"mv-part":d,"mv-seek":f},callback:function(){},processbar:!1}):(c={},c[b]={"mv-chap":g,"mv-server":e,"mv-part":d,"mv-seek":f},self.app._Store.update("mvlastview",c)))};PageModuleCineMovie.prototype.Close=function(){this.Movie_Close();this.player&&this.player.remove()};
