var PageModuleShareLink=function(b){this.app=b;this.setting={"class":{},trigger:{},height:0,user:!0,blank:!1,view:!0,share:!0,comment:!0,more:!0};this.template={}};
PageModuleShareLink.prototype={Description:function(){return"this.descript"},Init:function(b){if("undefined"==typeof this.inited)this.inited=!0;else return!0;var a=this;this.form=b;this.posts=this.form.find(".main .posts:first");b=JSON.parse(Base64.decode(this.form.attr("module-setting")));for(var d in b)this.setting[d]=b[d];a.template.post=Base64.decode(a.form.attr("module-template"));this.form.on("click",".view-more",function(b){var f=a.form.find(".main .post:last");if(1==f.length){var c=f.find(".time:first").attr("time"),
e=[f.attr("post-id")],f=f.find(".view .value:first").html();a.Load(window.location.href,{time:c,post:e,view:f})}b.preventDefault();b.stopPropagation()});a.app._Router.AddCallback(this.form.parents("[site-name]:first").attr("site-name"),this.form.parents("[page-name]:first").attr("page-name"),function(b){var f=b.match(/[a-z0-9]{24}/g);null!=f&&0<f.length&&(f=f[0],a.form.find(".post").removeClass("active"),a.form.find(".post[post-id="+f+"]").addClass("active"));try{var c=b.split("?",2)[1].split("&"),
e;for(e in c)if(l=c[e].split("="),"tab"==l[0])var d=l[1]}catch(h){}"undefined"!=typeof d&&(c=a.form.find(".tabmenu:first>li[md-tab="+d+"]"),c.length=!c.hasClass("active"))&&(e=a.form.find(".tabmenu:first>li.active"),a.form.find(".tabmenu:first>li").removeClass("active"),c.addClass("active"),c=e.attr("md-tab"),a.form.find(".posts:first .post").remove(),a.Load(b,{}),a.form.find(".posts:first").removeClass(c).addClass(d))})},Load:function(b,a){var d=this;if("undefined"!=typeof a.post){"string"==typeof a.time&&
$.each(d.form.find(".main .post"),function(b,c){var e=$(c);e.find(".time:first").attr("time")==a.time&&a.post.push(e.attr("post-id"))});"string"==typeof a.view&&$.each(d.form.find(".main .post"),function(b,c){var e=$(c);e.find(".view .value:first").html()==a.view&&a.post.push(e.attr("post-id"))});var g=[];$.each(a.post,function(b,a){-1===$.inArray(a,g)&&g.push(a)});a.post=g.join(",")}a.module=d.form.attr("module-id");d.app._ProcessBar.Reset();d.app._ProcessBar.Run(50);PageAjax({type:"post",dataType:"json",
url:b,data:a}).done(function(b){"undefined"!=typeof b.post&&(d.app._ProcessBar.Run(100),d.posts.append(d.Render("post",b.post)),d.Refesh())}).error(function(b){console.error(b)})},Render:function(b,a){var d=this,g="";$.each(a,function(a,c){var e=d.template[b];$.each(c,function(b,a){e=e.split("{{ "+b+" }}").join(a)});g+=e});return g},Refesh:function(){var b=this;"undefined"!=typeof b.setting["class"]&&$.each(b.setting["class"],function(a,f){var c=b.form.find("."+a);$.each(c,function(b,a){var c=$(a);
c.data("md-classed")||c.addClass(f).data("md-classed",!0)})});var a=b.form.find(".content .video");$.each(a,function(b,a){var c=$(a),e=c.attr("link");try{var e=e.split("youtube.com/watch?v=",2)[1].split("/[#|?]/",1)[0],d=$('<img class="picture" src="http://i1.ytimg.com/vi/'+e+'/hqdefault.jpg"></img>').insertAfter(c),h=$('<div class="play-button"></div>').insertAfter(d);c.remove();h.css({top:(.7*d.width()-35)/2,left:(d.width()-50)/2})}catch(k){console.error(k)}});"undefined"!=typeof b.setting.user&&
(a=b.form.find(".post .user .by"),b.setting.user?a.show():a.hide());"undefined"!=typeof b.setting.blank&&b.setting.blank?(a=b.form.find(".posts .post"),$.each(a,function(b,a){var c=$(a);c.data("md-blanked")||(c.find(".image a").attr("target","_blank"),c.find(".title a").attr("target","_blank"),c.data("md-blanked",!0))})):b.form.find(".post .image a:not([site-goto]), .post .title a:not([site-goto])").attr("site-goto","+");a=!1;"undefined"!=typeof b.setting.view&&b.setting.view&&b.form.find(".post .user .info .view").show();
"undefined"!=typeof b.setting.share&&b.setting.share&&(b.form.find(".post .user .info .share").show(),a=!0);"undefined"!=typeof b.setting.comment&&b.setting.comment&&(b.form.find(".post .user .info .comment").show(),a=!0);a&&(a=b.form.find(".posts .post"),$.each(a,function(b,a){var c=$(a);if(!c.data("md-fb-info-updated")){var d=c.find(".title a:first")[0].href;$.getJSON("http://graph.facebook.com/?id="+d,function(a){c.find(".info .comment:first .value").html("undefined"!=typeof a.comments?a.comments:
0);c.find(".info .share:first .value").html("undefined"!=typeof a.shares?a.shares:0)});c.data("md-fb-info-updated",!0)}}));"undefined"!=typeof b.setting.more&&(a=b.form.find(".footer .view-more"),a.data("md-mored")||(b.setting.more?a.show():a.hide(),a.data("md-mored",!0)));"number"==typeof b.setting["max-height"]&&0<b.setting["max-height"]&&(a=b.form.find(".main:first"),a.data("md-heighted")||(a.css("max-height",b.setting["max-height"]+"vh"),a.data("md-heighted",!0)));try{FB.XFBML.parse(this.form[0])}catch(d){console.debug(d)}$.each(b.posts.children(".post"),
function(a,b){$(b).find(".voter .index").html(a+1)});this.timer=this.form.find(".user .info .time:first");this.timer.data("timer")||(b.app._Timer.Add(b.timer),b.timer.data("timer",!0))}};
