var PageModuleSharePost=function(a){this.app=a;this.setting={"class":{},trigger:{},like:!0,comment:!0,toolbar:"affix"};this.template={};this.store={}};
PageModuleSharePost.prototype={Description:function(){return"this.descript"},Init:function(a){if("undefined"==typeof this.inited)this.inited=!0;else return!0;var c=this;this.form=a;a=JSON.parse(Base64.decode(this.form.attr("module-setting")));for(var b in a)this.setting[b]=a[b];c.template.post=Base64.decode(c.form.attr("module-template"));this.form.bind("view",function(a,b){"undefined"!=typeof b.id&&c.Load({post:b.id});a.preventDefault();a.stopPropagation()});c.app._Router.AddCallback(this.form.parents("[site-name]:first").attr("site-name"),
this.form.parents("[page-name]:first").attr("page-name"),function(a){a=a.match(/[a-z0-9]{24}/g);null!=a&&0<a.length&&c.Load({post:a[0]})})},Load:function(a){var c=this;if("undefined"!=typeof a.post){var b=c.form.find(".post[post-id="+a.post+"]");if(0==b.length){var f=c.form.find(".posts .post[post-id]");$.each(f,function(a,b){var g=$(b),d=g.attr("post-id");c.store[d]=g.detach()});c.form.find(".posts").html("");"undefined"!=typeof c.store[a.post]?b.is(":visible")||(c.app._ProcessBar.Reset(),c.app._ProcessBar.Run(100),
c.form.find(".posts").append(c.store[a.post]),c.Refesh()):(a.module=this.form.attr("module-id"),c.app._ProcessBar.Reset(),c.app._ProcessBar.Run(50),PageAjax({url:window.location.href,type:"post",dataType:"json",data:a}).done(function(a){"undefined"!=typeof a.post&&(c.app._ProcessBar.Run(100),c.form.find(".main .posts:first").append(c.Render("post",a.post)),c.Refesh());if("undefined"!=typeof a.graph){var b=c.form.parents(".site:first").data("site-object");"undefined"!=typeof b&&b.UpdateGraph(a.graph)}}).error(function(a){console.error(a)}))}}},
Render:function(a,c){var b=this.template[a];$.each(c,function(a,c){b=b.split("{{ "+a+" }}").join(c)});return b},Refesh:function(){var a=this,c=a.form.find(".content .video");$.each(c,function(a,b){var d=$(c),e=d.attr("link"),h=d.parents(".content:first").width(),l=315*h/560;try{e=e.split("youtube.com/watch?v=",2)[1].split("/[#|?]/",1)[0],d.after($('<iframe width="'+h+'" height="'+l+'" src="//www.youtube.com/embed/'+e+'" frameborder="0" allowfullscreen></iframe>')),d.remove()}catch(f){console.error(f)}});
try{var b=a.form.find(".warning:first");0<b.children(".content:first").html().length?b.show():b.hide()}catch(f){console.error(f)}"undefined"!=typeof a.setting["class"]&&$.each(a.setting["class"],function(c,b){var d=a.form.find("."+c);$.each(d,function(a,c){var d=$(c);d.data("md-classed")||d.addClass(b).data("md-classed",!0)})});"undefined"!=typeof a.setting.trigger&&"undefined"!=typeof a.setting.trigger.more&&$.each(a.setting.trigger.more,function(c,b){a.form.parents(".page:first").find("[module-id="+
b+"]:first").trigger("more","more")});"undefined"!=typeof a.setting.like&&a.setting.like&&(b=a.form.find(".facebook-likeshare"),$.each(b,function(a,c){var d=$(c);if(!d.data("md-liked")){var b=d.parents(".post:first").find(".title a:first")[0].href;0==d.children().length&&$('<div class="fb-like " data-width="'+d.width()+'px" data-href="'+b+'" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>').appendTo(d);d.data("md-liked",!0)}}));"undefined"!=typeof a.setting.comment&&
a.setting.comment&&(b=a.form.find(".facebook-comments"),$.each(b,function(a,c){var d=$(c);if(!d.data("md-commented")){var b=d.parents(".post:first").find(".title a:first")[0].href;0==d.children().length&&$('<div class="fb-comments " data-width="'+d.width()+'px" data-href="'+b+'" data-numposts="10" data-colorscheme="light"></div>').appendTo(d);d.data("md-commented",!0)}}));"undefined"!=typeof a.setting.toolbar&&"affix"==a.setting.toolbar&&(b=a.form.find(".toolbar"),$.each(b,function(a,c){var b=$(c);
if(!b.data("md-toolbar-affixed")){var e=$(".site-headers:first header.site-header").outerHeight();b.affix({offset:{top:function(){return this.top=b.offset().top-e}}});b.bind("affix.bs.affix",function(a){b.css({top:e,width:b.outerWidth()})});b.bind("affix-top.bs.affix affix-bottom.bs.affix",function(a){b.css({width:"",top:""})});b.data("md-toolbar-affixed",!0)}}));try{FB.XFBML.parse(this.form[0])}catch(k){console.debug(k)}FB.Event.subscribe("edge.create",function(a,b){console.debug(a,b)});FB.Event.subscribe("edge.remove",
function(a,b){console.debug(a,b)});this.timer=this.form.find(".user .info .time:first");this.timer.data("timer")||(a.app._Timer.Add(a.timer),a.timer.data("timer",!0))}};
