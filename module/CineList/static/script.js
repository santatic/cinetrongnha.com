PageModuleCineList.prototype=new Module;PageModuleCineList.prototype.constructor=PageModuleCineList;function PageModuleCineList(a){Module.call(this,a);$.extend(this.setting,{blank:!0,post_ajax:0})}
PageModuleCineList.prototype.Init=function(a){Module.prototype.Init.call(this,a);var b=this;this.form.on("click",".view-more",function(a){var h=b.form.find(".posts .post");b.form.find(".footer").addClass("loading");b.Load({query:{skip:h.length},processbar:!1});a.preventDefault();a.stopPropagation()});b.onRouter(function(a){try{var h=a.param.tab}catch(c){}if(void 0!=h){var d=b.form.find(".tabmenu:first>li[md-tab="+h+"]");if(d.length=!d.hasClass("active")){var f=b.form.find(".tabmenu:first>li.active");
b.form.find(".tabmenu:first>li").removeClass("active");d.addClass("active");d=f.attr("md-tab");b.form.find(".posts:first .post").remove();b.Load({query:{},url:a.url});b.form.find(".posts:first").removeClass(d).addClass(h)}}},{param:1});b.modal=$('<div class="CineList modal fade" role="dialog" aria-hidden="true"><div class="dialog col-md-10 col-md-offset-1"><div class="modal-content"></div></div></div>').modal({show:!1});b.form.on("click",".post",function(a){$(a.target).is(".title")||(a=$(this).attr("post-id"),
b.Load({query:{action:"info",tab:"info",post:[a]},callback:function(a){void 0!=a.post&&(a=b.Render("info",a.post),b.modal.find(".modal-content").html(a),b.modal.modal("show"),b.Refesh())}}))});var f="";b.modal.on("shown.bs.modal",function(a){f=""}).on("hidden.bs.modal",function(a){""!=f&&b.app._Router.Goto(f);b.modal.find(".modal-content").html("")}).on("click","[site-goto]",function(a){f=$(this).attr("href");b.modal.modal("hide");a.preventDefault();a.stopPropagation()});b.modal.on("click",".modal-footer .btn.view",
function(){b.modal.modal("hide")});if(0<b.setting.post_ajax){var c=function(a){a=b.form.find(".footer .view-more");a.is(":visible")&&$(window).scrollTop()+$(window).height()>a.offset().top&&(a.click(),b.setting.post_ajax--,0>=b.setting.post_ajax&&$(window).off("scroll",c))};$(window).on("scroll",c)}};
PageModuleCineList.prototype.Load=function(a){a=$.extend({query:{},callback:void 0,url:window.location.href},a);if(void 0!=a.query.post){"string"==typeof a.query.time&&$.each(this.form.find(".main .post"),function(b,c){var g=$(c);g.find(".time:first").attr("time")==a.query.time&&a.query.post.push(g.attr("post-id"))});"string"==typeof a.query.view&&$.each(this.form.find(".main .post"),function(b,c){var g=$(c);g.find(".view .value:first").html()==a.query.view&&a.query.post.push(g.attr("post-id"))});
var b=[];$.each(a.query.post,function(a,c){-1===$.inArray(c,b)&&b.push(c)});a.query.post=b.join(",")}Module.prototype.Load.call(this,a)};
PageModuleCineList.prototype.Refesh=function(){Module.prototype.Refesh.call(this);if(450>this.form.width()){var a=this.form.find(".posts .post");$.each(a,function(a,b){$(b).addClass("mini")})}try{var b=this.modal.find(".facebook-comment"),f=b.attr("href");0==b.children().length&&$('<div class="fb-comments" data-width="100%" data-href="'+f+'" data-numposts="10" data-colorscheme="light"></div>').appendTo(b)}catch(c){}this.setting.more&&(a=this.form.find(".footer .view-more"),a.data("md-mored")||(this.setting.more?
a.show():a.hide(),a.data("md-mored",!0)));"number"==typeof this.setting["max-height"]&&0<this.setting["max-height"]&&(a=this.form.find(".main:first"),a.data("md-heighted")||(a.css("max-height",this.setting["max-height"]+"vh"),a.data("md-heighted",!0)));a=this.form.find(".post .rate");$.each(a,function(a,b){var d=$(b);0==d.find(".rating-input").length&&d.find(".rating").rating({editable:!1})});this.setting.blank&&(this.form.find("[site-goto]").removeAttr("site-goto").attr("target","_blank"),this.modal.find(".modal-footer .btn.view[site-goto]").removeAttr("site-goto").attr("target",
"_blank"));a=this.form.find("img.lazy");$.each(a,function(a,b){var d=$(b);d.data("lazyed")||($(b).lazyload({effect:"fadeIn"}),d.data("lazyed",!0))});a=this.form.find(".info:not(.info-fixed)");$.each(a,function(a,b){var d=$(b),c=d.find(".imdb"),e=c.find(".value").html().trim();"0"!=e&&""!=e||c.css("opacity",0);c=d.find(".view .value");e=parseInt(c.html().trim());1E6<e?e=parseInt(e/1E6)+"M":1E3<e&&(e=parseInt(e/1E3)+"K");c.html(e);d.addClass("info-fixed")});try{FB.XFBML.parse(this.modal[0])}catch(g){}};
